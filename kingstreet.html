<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Client Form | King Street Psychology Clinic</title>
    <link rel="stylesheet" href="kingstreet-styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body class="kingstreet-body">
    <!-- Mobile Navigation -->
    <div class="mobile-navigation">
        <div class="navbar-mobile">
            <div class="container-mobile">
                <a href="index.html" class="nav-brand">
                    <img src="https://cdn.prod.website-files.com/63e9c9689b9d021a49f14b6b/63e9c9689b9d024903f14c3d_Logo%20(3).png" loading="lazy" alt="" class="mobile-logo">
                </a>
                <nav class="nav-menu-mobile">
                    <a href="index.html" class="nav-link">Home</a>
                    <div class="nav-dropdown-mobile">
                        <div class="dropdown-toggle-mobile">
                            <div>Services</div>
                        </div>
                    </div>
                    <a href="#" class="nav-link">Research</a>
                    <div class="nav-dropdown-mobile">
                        <div class="dropdown-toggle-mobile">
                            <div>About</div>
                        </div>
                    </div>
                    <a href="#" class="nav-link active">Book an appointment</a>
                </nav>
                <div class="menu-button">
                    <div class="menu-icon"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Desktop Navigation -->
    <div class="navigation-block">
        <div class="navigation-inner">
            <a href="index.html" class="logo-link">
                <img src="https://cdn.prod.website-files.com/63e9c9689b9d021a49f14b6b/65b18c19c6db4c2062a95afb_KS%20logo.png" loading="lazy" width="262" alt="King Street Psychology Clinic" class="logo-image">
            </a>
            <header class="header-navigation">
                <a href="index.html" class="navigation-link">Home</a>
                <div class="nav-dropdown">
                    <div class="dropdown-toggle">
                        <div class="dropdown-icon"></div>
                        <div class="dropdown-text">About</div>
                    </div>
                    <nav class="dropdown-list">
                        <a href="#" class="dropdown-nav">Meet the team</a>
                        <a href="#" class="dropdown-nav">Fees &amp; Rebates</a>
                        <a href="#" class="dropdown-nav">Location</a>
                    </nav>
                </div>
                <div class="nav-dropdown">
                    <div class="dropdown-toggle">
                        <div class="dropdown-icon"></div>
                        <div class="dropdown-text">Services</div>
                    </div>
                    <nav class="dropdown-list">
                        <a href="#" class="dropdown-nav">General Mental Health</a>
                        <a href="#" class="dropdown-nav">Adult Gender &amp; Sexology Services</a>
                        <a href="#" class="dropdown-nav">Child &amp; Adolescent Gender Services</a>
                        <a href="#" class="dropdown-nav">Speech Pathology</a>
                    </nav>
                </div>
                <a href="#" class="navigation-link">Research</a>
                <a href="#" class="navigation-link">Rent a room</a>
                <a href="#" class="navigation-link button active">Book Appointment<br><br>0413 825 238</a>
            </header>
        </div>
    </div>

    <!-- Hero Section -->
    <div class="section hero-section">
        <div class="section-inner">
            <div class="container">
                <div class="hero-title-wrap">
                    <h1 class="title">New Clients</h1>
                    <div class="hero-content">
                        <p class="publication-title purple">
                            <strong class="bold-text">Our psychologists look forward to assisting you.</strong><br><br>
                            To make an appointment, our friendly reception team will speak with you for 5-10 minutes by phone to take the information we need to match you with the most suitable psychologist.<br><br>
                            Please call us on 0413 825 238, Monday - Friday, 8am -4pm, or email us on reception@kingstreetpsychology.com.<br><br>
                            Or complete our <a href="#email-form" class="purple-link">contact form</a>.
                        </p>
                        <div class="contact-details-wrap">
                            <div class="contact-row">
                                <img src="https://cdn.prod.website-files.com/63e9c9689b9d021a49f14b6b/63e9c9689b9d020310f14bdd_Phone.png" loading="lazy" alt="" class="location-icon">
                                <p class="publication-title purple contact-info">
                                    <a href="tel:0413825238" class="contact-link"><strong>0413 825 238</strong></a>
                                </p>
                            </div>
                            <div class="contact-row">
                                <img src="https://cdn.prod.website-files.com/63e9c9689b9d021a49f14b6b/63e9c9689b9d0250e5f14b99_emal-.svg" loading="lazy" alt="" class="location-icon">
                                <p class="publication-title purple contact-info">
                                    <a href="mailto:reception@kingstreetpsychology.com" class="contact-link"><strong class="bold-text">reception@kingstreetpsychology.com</strong></a>
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container">
                    <div class="hero-title-wrap">
                        <div class="hero-content">
                            <h1 class="title"><strong>Contact Form</strong></h1>
                            <p class="publication-title purple">
                                <strong class="bold-text">Please note that in order to offer you an appointment, our friendly reception team will take down your information during a brief phone call. Please be sure to include the days/times our reception team can reach you for 5-10 minutes.</strong>
                            </p>
                            <div class="newclient-form-wrap">
                                <div class="newclient-form">
                                    <form id="email-form" name="email-form" data-name="Email Form" method="post" class="newclient-form-inner">
                                        <div class="field-wrap half">
                                            <label for="name-3" class="field-label"><strong>Legal First Name</strong>*</label>
                                            <input class="field-input" maxlength="256" name="name-3" data-name="Name 3" placeholder="" type="text" id="name-3" required="">
                                        </div>
                                        <div class="field-wrap half">
                                            <label for="Surname-2" class="field-label"><strong>Preferred First Name</strong></label>
                                            <input class="field-input" maxlength="256" name="Surname-2" data-name="Surname 2" placeholder="" type="text" id="Surname-2">
                                        </div>
                                        <div class="field-wrap half">
                                            <label for="name-2" class="field-label"><strong>Surname</strong>*</label>
                                            <input class="field-input" maxlength="256" name="name-2" data-name="Name 2" placeholder="" type="text" id="name-2" required="">
                                        </div>
                                        <div class="field-wrap half">
                                            <label for="Email-2" class="field-label">Email address*</label>
                                            <input class="field-input" maxlength="256" name="Email-2" data-name="Email 2" placeholder="" type="email" id="Email-2" required="">
                                        </div>
                                        <div class="field-wrap half">
                                            <label for="Phone-2" class="field-label">Contact number*</label>
                                            <input class="field-input" maxlength="256" name="Phone-2" data-name="Phone 2" placeholder="" type="tel" id="Phone-2" required="">
                                        </div>
                                        <div class="field-wrap half">
                                            <label for="Age-2" class="field-label">Age of client being referred</label>
                                            <input class="field-input" maxlength="256" name="Age-2" data-name="Age 2" placeholder="" type="number" id="Age-2" required="">
                                        </div>
                                        <div class="field-wrap half">
                                            <label for="Preferred-therapist-2" class="field-label"><strong>Preferred days /time for a 5-10min reception call*</strong></label>
                                            <input class="field-input" maxlength="256" name="Preferred-therapist-2" data-name="Preferred Therapist 2" placeholder="" type="text" id="Preferred-therapist-2" required="">
                                        </div>
                                        <div class="field-wrap full">
                                            <label for="additional-info-2" class="field-label">Please provide any details regarding the issues you would like our assistance with<br></label>
                                            <textarea id="additional-info-2" name="additional-info-2" maxlength="5000" data-name="Additional Info 2" placeholder="Max 200 words" class="field-input textarea"></textarea>
                                            <label for="field" class="field-label-note">This information will be kept strictly confidential and only viewable by our receptionist and your treating psychologist</label>
                                        </div>
                                        <div class="cta-wrapper">
                                            <input type="submit" data-wait="Please wait..." class="hero-cta" value="Submit Form">
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <p class="publication-title purple">
                                <br>Crisis Support<br>‍<br>
                                <strong class="bold-text">‍This practice operates by appointment only. Unfortunately, we cannot offer emergency or crisis support. If it is an emergency or you are in immediate risk of harm to yourself or others, please call 000. If you need to speak to someone now you can contact a helpline support <a href="https://www.kingstreetpsychologyclinic.com.au/helplines" target="_blank" class="purple-link">here</a>.</strong>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div class="footer-content">
                    <div class="footer-logowrapper">
                        <a href="#" class="navigation-logoblock">
                            <img src="https://cdn.prod.website-files.com/63e9c9689b9d021a49f14b6b/63e9c9689b9d0276fdf14bb9_KSPC%20Logo%20Suite_KSPC%20Logo%20Horizontal.png" loading="lazy" alt="" class="footer-logo">
                        </a>
                    </div>
                    <div class="footer-menuwrap">
                        <a href="#" class="footer-link">Meet the team</a>
                        <a href="#" class="footer-link">Fees and Rebates</a>
                        <a href="#" class="footer-link">Research</a>
                        <a href="#" class="footer-link active">Book Appointment</a>
                    </div>
                    <div class="footer-contact-block">
                        <div class="footer-contact-grid">
                            <div class="footer-contact-item">
                                <a href="tel:0413825238" class="footer-contact-link">0413 825 238</a>
                            </div>
                            <div class="footer-contact-item">
                                <a href="mailto:Reception@kingstreetpsychology.com" class="footer-contact-link">Reception@kingstreetpsychology.com</a>
                            </div>
                            <div class="footer-contact-item">
                                <a href="#" target="_blank" class="footer-contact-link">Suite 207, 1 Erskineville Rd, Newtown 2042</a>
                            </div>
                            <div class="footer-contact-item">
                                <a href="#" target="_blank" class="footer-contact-link">Suites 7, 10, 14, 134-140 King St, Newtown 2042</a>
                            </div>
                        </div>
                    </div>
                    <div class="footer-affiliation-wrap">
                        <div class="footer-aff-title-block">
                            <div class="footer-aff-title">Professional memberships, registrations, and affiliations</div>
                        </div>
                        <div class="aff-logowrap">
                            <img src="https://cdn.prod.website-files.com/63e9c9689b9d021a49f14b6b/679d563ca99ad769178263ad_APS.png" loading="lazy" alt="" class="aff-logo">
                            <img src="https://cdn.prod.website-files.com/63e9c9689b9d021a49f14b6b/63e9c9689b9d02dd4ff14ba6_acpa-member-logo.png" loading="lazy" alt="" class="aff-logo">
                            <img src="https://cdn.prod.website-files.com/63e9c9689b9d021a49f14b6b/63e9c9689b9d027972f14bb5_AP-Logo-2.png" loading="lazy" alt="" class="aff-logo">
                            <img src="https://cdn.prod.website-files.com/63e9c9689b9d021a49f14b6b/63e9c9689b9d02d8b6f14b9f_gender-centre-sml-logo-site.fw.png" loading="lazy" alt="" class="aff-logo">
                            <img src="https://cdn.prod.website-files.com/63e9c9689b9d021a49f14b6b/63e9c9689b9d02148cf14ba0_Logo-Medicare-transparent.png" loading="lazy" alt="" class="aff-logo">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>

    
    <!-- Add this script at the end of the HTML body -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Find the form element - adjust the selector if needed
            const form = document.getElementById('email-form');
            
            if (!form) {
                console.error('Could not find the form element');
                return;
            }
            
            // STEP 1: Replace the additional-info-2 field with our 4 psychology questions
            const additionalInfoField = document.getElementById('additional-info-2');
            if (additionalInfoField) {
                // Find the parent wrapper
                const fieldWrap = additionalInfoField.closest('.field-wrap');
                
                if (fieldWrap) {
                    // Create the HTML for our four fields
                    const psychologyFieldsHTML = `
                        <div class="field-wrap full">
                            <label for="concerns" class="field-label"><strong>What are your main concerns or difficulties that have led you to seek help?</strong>*</label>
                            <textarea id="concerns" name="concerns" maxlength="5000" data-name="Concerns" placeholder="Please describe what is troubling you" class="field-input textarea" required></textarea>
                        </div>
                        
                        <div class="field-wrap full">
                            <label for="onset" class="field-label"><strong>When did these difficulties begin?</strong>*</label>
                            <textarea id="onset" name="onset" maxlength="5000" data-name="Onset" placeholder="Please describe when these issues started and any significant events related to their onset" class="field-input textarea" required></textarea>
                        </div>
                        
                        <div class="field-wrap full">
                            <label for="symptoms" class="field-label"><strong>What symptoms or changes have you noticed?</strong>*</label>
                            <textarea id="symptoms" name="symptoms" maxlength="5000" data-name="Symptoms" placeholder="Please describe any changes in your thoughts, feelings, behaviors, or physical sensations" class="field-input textarea" required></textarea>
                        </div>
                        
                        <div class="field-wrap full">
                            <label for="stresses" class="field-label"><strong>Are there any current stresses or life changes that might be contributing to these difficulties?</strong></label>
                            <textarea id="stresses" name="stresses" maxlength="5000" data-name="Stresses" placeholder="Please describe any relevant life circumstances (optional)" class="field-input textarea"></textarea>
                        </div>
                        
                        <div class="field-wrap full">
                            <label for="field" class="field-label-note">This information will be kept strictly confidential and only viewable by our receptionist and your treating psychologist</label>
                        </div>
                    `;
                    
                    // Replace the field wrap with our new fields
                    fieldWrap.insertAdjacentHTML('afterend', psychologyFieldsHTML);
                    fieldWrap.remove(); // Remove the original field
                } else {
                    console.error('Could not find the field wrapper for additional-info-2');
                }
            } else {
                console.error('Could not find the additional-info-2 field');
            }
            
            // STEP 2: Set up form submission (rest of your existing code)
            // Replace with your actual Supabase function URL
            const API_ENDPOINT = 'https://oqsmnwugbmquikqgypqh.supabase.co/functions/v1/psychfinder-form';
            
            // Replace with your clinic's ID and API key (if applicable)
            const CLINIC_ID = '1fe7f0ac-3c4b-422a-9279-7f32fa37f06c';
            const CLIENT_API_KEY = 'vzj1afC9H1FLblPlMXxU-ypdov1owR-z'; // Optional, leave empty if not using
            
            // Add your Supabase anon key here
            const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9xc21ud3VnYm1xdWlrcWd5cHFoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcwMTc1OTUsImV4cCI6MjA2MjU5MzU5NX0.qG71U0_46GdTd_deKzA1b4S3uNojRUDn9ba8UFcusP8';
            
            // Add a success message div before the form
            const successMessage = document.createElement('div');
            successMessage.id = 'form-success';
            successMessage.style.cssText = `
                background-color: #d4edda;
                color: #155724;
                padding: 15px;
                border-radius: 4px;
                margin-bottom: 20px;
                display: none;
            `;
            successMessage.textContent = 'Your form has been submitted successfully. Our team will be in touch soon.';
            form.parentNode.insertBefore(successMessage, form);
            
            // Add a loading indicator
            const loadingIndicator = document.createElement('div');
            loadingIndicator.id = 'loading-indicator';
            loadingIndicator.style.cssText = `
                display: none;
                text-align: center;
                margin: 20px 0;
            `;
            
            // Style the loading spinner
            const style = document.createElement('style');
            style.textContent = `
                #loading-indicator::after {
                    content: "";
                    display: inline-block;
                    width: 30px;
                    height: 30px;
                    border: 4px solid #f3f3f3;
                    border-top: 4px solid #6d3b90;
                    border-radius: 50%;
                    animation: spin 1s linear infinite;
                }
                
                @keyframes spin {
                    0% { transform: rotate(0deg); }
                    100% { transform: rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
            
            // Add the loading indicator before the submit button
            const submitButton = form.querySelector('input[type="submit"]');
            if (submitButton) {
                const submitContainer = submitButton.parentNode;
                submitContainer.parentNode.insertBefore(loadingIndicator, submitContainer);
            } else {
                // If submit button not found, add to the end of the form
                form.appendChild(loadingIndicator);
            }
            
            // Override the form submission
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                // Validate required fields (concerns, onset, symptoms)
                const concerns = document.getElementById('concerns');
                const onset = document.getElementById('onset');
                const symptoms = document.getElementById('symptoms');
                
                if (!concerns || !onset || !symptoms) {
                    alert('Required assessment fields are missing. Please ensure all required fields are present.');
                    return;
                }
                
                if (!concerns.value.trim() || !onset.value.trim() || !symptoms.value.trim()) {
                    alert('Please complete all required assessment fields.');
                    return;
                }
                
                // Show loading indicator
                loadingIndicator.style.display = 'block';
                
                // Collect form data
                const formData = new FormData(form);
                const formObject = {};
                
                // Map original form fields to the API expected fields
                formData.forEach((value, key) => {
                    switch(key) {
                        // Map existing form fields to API field names
                        case 'name-3':
                            formObject.legal_first_name = value;
                            break;
                        case 'Surname-2':
                            formObject.preferred_first_name = value;
                            break;
                        case 'name-2':
                            formObject.surname = value;
                            break;
                        case 'Email-2':
                            formObject.email = value;
                            break;
                        case 'Phone-2':
                            formObject.phone = value;
                            break;
                        case 'Age-2':
                            formObject.age = value;
                            break;
                        case 'Preferred-therapist-2':
                            formObject.preferred_time = value;
                            break;
                        // Added fields
                        case 'concerns':
                        case 'onset':
                        case 'symptoms':
                        case 'stresses':
                            formObject[key] = value;
                            break;
                        default:
                            // Include other fields as they are
                            formObject[key] = value;
                    }
                });
                
                // Add the clinic ID to the form data
                formObject.clinic_id = CLINIC_ID;
                
                try {
                    // Send form data to API
                    const fetchOptions = {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${SUPABASE_ANON_KEY}`, // Add Supabase authorization
                        },
                        body: JSON.stringify(formObject),
                    };
                    
                    // Add API key as header if provided
                    if (CLIENT_API_KEY) {
                        fetchOptions.headers['X-Client-API-Key'] = CLIENT_API_KEY;
                    }
                    
                    const response = await fetch(API_ENDPOINT, fetchOptions);
                    
                    const result = await response.json();
                    
                    // Hide loading indicator
                    loadingIndicator.style.display = 'none';
                    
                    if (response.ok) {
                        // Show success message
                        form.reset();
                        successMessage.style.display = 'block';
                        successMessage.scrollIntoView({ behavior: 'smooth' });
                        
                        // Hide success message after some time
                        setTimeout(() => {
                            successMessage.style.display = 'none';
                        }, 10000);
                    } else {
                        // Handle error
                        alert('There was an error submitting the form: ' + (result.error || 'Unknown error'));
                        console.error('Form submission error response:', result);
                    }
                } catch (error) {
                    // Hide loading indicator
                    loadingIndicator.style.display = 'none';
                    
                    // Handle error
                    alert('There was an error submitting the form. Please try again or contact us directly.'); 
                    console.error('Form submission error:', error);
                }
            });
            
            // Add debug feature - hold Shift+D for 3 seconds to show debug info
            let debugKeyTimer;
            document.addEventListener('keydown', function(e) {
                if (e.shiftKey && e.key === 'D') {
                    debugKeyTimer = setTimeout(() => {
                        const debugInfo = {
                            endpoint: API_ENDPOINT,
                            clinic_id: CLINIC_ID,
                            apiKeyProvided: !!CLIENT_API_KEY,
                            supabaseKeyProvided: !!SUPABASE_ANON_KEY
                        };
                        console.log('Debug Info:', debugInfo);
                        alert('Debug info logged to console');
                    }, 3000);
                }
            });
            
            document.addEventListener('keyup', function(e) {
                if (e.key === 'D' || !e.shiftKey) {
                    clearTimeout(debugKeyTimer);
                }
            });
        });
    </script>
    

</body>
</html>